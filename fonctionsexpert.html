<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Maths 2de : Niveau Expert (Nav Libre)</title>
    <script>
        window.MathJax = {
            tex: { inlineMath: [['$', '$'], ['\\(', '\\)']] },
            startup: { typeset: false }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="https://unpkg.com/d3@3/d3.min.js"></script>
    <script src="https://unpkg.com/function-plot@1/dist/function-plot.js"></script>
    <style>
        :root {
            --primary: #dc2626;
            --primary-hover: #b91c1c;
            --bg: #111827;
            --card: #1f2937;
            --text: #f9fafb;
            --text-muted: #9ca3af;
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .container {
            background: var(--card);
            width: 100%;
            max-width: 900px;
            border-radius: 16px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.5);
            overflow: hidden;
            padding: 30px;
            border: 1px solid #374151;
        }

        header { text-align: center; margin-bottom: 25px; }
        h1 { color: var(--primary); font-size: 1.8rem; margin: 0 0 10px 0; text-transform: uppercase; letter-spacing: 1px; }

        .progress-container {
            background-color: #374151;
            border-radius: 99px;
            height: 6px;
            width: 100%;
            margin-bottom: 15px;
            overflow: hidden;
        }
        .progress-bar {
            background-color: var(--primary);
            height: 100%;
            width: 0%;
            transition: width 0.3s ease;
        }

        /* --- ZONE VISUELLE --- */
        .visual-container {
            width: 100%;
            height: 400px;
            margin: 0 auto 25px auto;
            border: 1px solid #4b5563;
            border-radius: 8px;
            background: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            position: relative;
        }

        /* Styles Function-Plot ajust√©s */
        .function-plot .grid .tick line { stroke: #d1d5db !important; opacity: 0.7; }
        .function-plot .axis path.domain { stroke: #000 !important; stroke-width: 2px !important; }
        .function-plot .axis text { fill: #000 !important; font-size: 12px !important; font-weight: bold; }

        /* --- INTERFACE QUIZ --- */
        .question-text { font-size: 1.3rem; font-weight: 600; margin-bottom: 20px; text-align: center; color: #e5e7eb; }
        .options-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 20px; }
        @media (max-width: 600px) { .options-grid { grid-template-columns: 1fr; } }

        .btn-option {
            background: #374151; border: 2px solid #4b5563; padding: 15px;
            border-radius: 8px; cursor: pointer; font-size: 1rem; color: white;
            transition: all 0.2s; text-align: left;
        }
        .btn-option:hover:not(:disabled) { border-color: var(--primary); background-color: #4b5563; }
        .btn-option.correct { background-color: #064e3b; border-color: #10b981; color: #ecfdf5; }
        .btn-option.wrong { background-color: #7f1d1d; border-color: #ef4444; color: #fef2f2; opacity: 0.8; }

        .feedback { padding: 15px; border-radius: 8px; margin-top: 15px; display: none; line-height: 1.5; color: #1f2937; }
        .feedback.hint { background-color: #fffbeb; border-left: 5px solid #f59e0b; color: #92400e; }
        .feedback.success { background-color: #d1fae5; border-left: 5px solid #10b981; color: #065f46; }

        .controls { display: flex; justify-content: space-between; margin-top: 20px; height: 50px; }
        .btn-nav { color: white; border: none; padding: 12px 24px; border-radius: 6px; font-size: 1rem; cursor: pointer; transition: background 0.2s;}
        .btn-next { background-color: var(--primary); }
        .btn-next:hover { background-color: var(--primary-hover); }
        .btn-prev { background-color: #4b5563; display: none; }
        .btn-prev:hover { background-color: #6b7280; }

        .result-screen { text-align: center; display: none; padding: 40px 0; }
        .score-circle {
            width: 150px; height: 150px; border-radius: 50%;
            background: conic-gradient(var(--primary) 0%, #374151 0%);
            display: flex; justify-content: center; align-items: center;
            margin: 0 auto 30px auto;
        }
        .score-inner {
            width: 130px; height: 130px; background: var(--card); border-radius: 50%;
            display: flex; justify-content: center; align-items: center;
            font-size: 2.5rem; font-weight: bold; color: var(--primary);
        }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>üî• Fonctions : Niveau Expert</h1>
        <div class="progress-container">
            <div class="progress-bar" id="progress-bar"></div>
        </div>
        <div style="display:flex; justify-content:space-between; color: var(--text-muted); font-size: 0.9rem;">
            <span>Score: <strong id="current-score-display">0</strong></span>
            <span>Question <span id="current-q">1</span> / <span id="total-q"></span></span>
        </div>
    </header>

    <div id="quiz-area">
        <div class="question-text" id="question-text"></div>
        <div class="visual-container" id="visual-area"></div>
        <div class="options-grid" id="options-container"></div>
        <div class="feedback hint" id="hint-area"></div>
        <div class="feedback success" id="success-area"></div>
        <div class="controls">
            <button class="btn-nav btn-prev" id="btn-prev" onclick="prevQuestion()">‚Üê Retour</button>
            <button class="btn-nav btn-next" id="btn-next" onclick="nextQuestion()">Suivant ‚Üí</button>
        </div>
    </div>

    <div id="result-area" class="result-screen">
        <h2>D√©fi Termin√© !</h2>
        <p>Ton score final :</p>
        <div class="score-circle" id="score-circle">
            <div class="score-inner" id="final-score"></div>
        </div>
        <p id="comment-score" style="font-size: 1.2rem; margin-bottom: 30px; color: var(--text-muted);"></p>
        <button class="btn-nav btn-next" onclick="location.reload()">Relever le d√©fi √† nouveau</button>
    </div>
</div>

<script>
    /*
     * DONN√âES DU QUIZ - VERSION DIFFICILE
     */
    const quizData = [
        // Q1
        {
            question: "Quel semble √™tre l'ensemble de d√©finition $\\mathcal{D}_f$ de cette fonction ?",
            plotConfig: {
                data: [
                    { fn: '-0.1*(x+3)*(x-4)*(x-1)', range: [-3, 4], color: '#dc2626', attr: { "stroke-width": 4 } },
                    { points: [[-3, 0], [4, 0]], fnType: 'points', graphType: 'scatter', color: 'black', attr: {r: 5} }
                ],
                yAxis: { domain: [-4, 6] },
                xAxis: { domain: [-5, 6] }
            },
            options: [
                { text: "$]-\\infty ; +\\infty[$", correct: false },
                { text: "$[-3 ; 4]$", correct: true },
                { text: "$]-3 ; 4[$", correct: false },
                { text: "$[-4 ; 6]$", correct: false }
            ],
            hint: "üí° Regarde o√π la courbe commence et o√π elle s'arr√™te sur l'axe horizontal.",
            explanation: "La courbe existe uniquement pour les valeurs de $x$ comprises entre -3 et 4 inclus."
        },
        // Q2
        {
            question: "Combien l'√©quation $f(x) = 1$ admet-elle de solutions ?",
            plotConfig: {
                data: [
                    { fn: '0.2*(x+2)*(x-1)*(x-3)*(x+1) + 1.5', color: '#dc2626', attr: { "stroke-width": 4 } },
                    { fn: '1', color: '#4b5563', attr: {'stroke-dasharray': '5,5'}, isHint: true }
                ],
                yAxis: { domain: [-2, 5] },
                xAxis: { domain: [-4, 4] }
            },
            options: [
                { text: "2 solutions", correct: false },
                { text: "3 solutions", correct: false },
                { text: "4 solutions", correct: true },
                { text: "0 solution", correct: false }
            ],
            hint: "üí° Trace une droite horizontale √† la hauteur $y=1$. Combien de fois coupe-t-elle la courbe rouge ?",
            explanation: "La droite horizontale $y=1$ coupe la courbe en 4 points distincts."
        },
        // Q3
        {
            question: "Que peut-on conjecturer sur la parit√© de la fonction repr√©sent√©e ?",
            plotConfig: {
                data: [
                    { fn: '0.1*x^3 - x', color: '#dc2626', attr: { "stroke-width": 4 } }
                ],
                yAxis: { domain: [-4, 4] },
                xAxis: { domain: [-4, 4] }
            },
            options: [
                { text: "Elle est paire", correct: false },
                { text: "Elle est impaire", correct: true },
                { text: "Elle n'est ni paire ni impaire", correct: false },
                { text: "Elle est positive", correct: false }
            ],
            hint: "üí° Observe la sym√©trie centrale par rapport √† l'origine (0;0).",
            explanation: "La courbe est sym√©trique par rapport √† l'origine $(0;0)$, ce qui caract√©rise une fonction impaire."
        },
        // Q4
        {
            question: "R√©soudre graphiquement l'√©quation $f(x) = g(x)$.",
            plotConfig: {
                dataOverride: [
                     { fn: '0.5*x^2 - 2', color: '#dc2626', attr: { "stroke-width": 4 } }, 
                     { fn: '0.5*x - 1', color: '#2563eb', attr: { "stroke-width": 4 } },
                     { points: [[-1, -1.5], [2, 0]], fnType: 'points', graphType: 'scatter', color: 'black', attr: {r: 6}, isHint: true }
                ],
                yAxis: { domain: [-4, 4] },
                xAxis: { domain: [-4, 5] }
            },
            options: [
                { text: "$S = \\{-1,5 ; 0\\}$", correct: false },
                { text: "$S = \\{-1 ; 2\\}$", correct: true },
                { text: "$S = [-1 ; 2]$", correct: false },
                { text: "$S = \\emptyset$", correct: false }
            ],
            hint: "üí° On cherche les abscisses ($x$) des points o√π les deux courbes se croisent.",
            explanation: "Les courbes se coupent aux points d'abscisses $x = -1$ et $x = 2$."
        },
        // Q5
        {
            question: "Sur quel intervalle a-t-on $f(x) \\ge g(x)$ ? (Rouge au-dessus de Bleu)",
            plotConfig: {
                data: [
                     { fn: '0.5*x^2 - 2', color: '#dc2626', attr: { "stroke-width": 4 } }, 
                     { fn: '0.5*x - 1', color: '#2563eb', attr: { "stroke-width": 4 } },
                     { fn: '0.5*x^2 - 2', range: [-5, -1], color: 'rgba(220, 38, 38, 0.3)', closed: true, isHint: true },
                     { fn: '0.5*x^2 - 2', range: [2, 5], color: 'rgba(220, 38, 38, 0.3)', closed: true, isHint: true }
                ],
                yAxis: { domain: [-4, 5] },
                xAxis: { domain: [-4, 5] }
            },
            options: [
                { text: "$[-1 ; 2]$", correct: false },
                { text: "$]-\\infty ; -1] \\cup [2 ; +\\infty[$", correct: true },
                { text: "$[-1,5 ; 0]$", correct: false },
                { text: "$[2 ; +\\infty[$", correct: false }
            ],
            hint: "üí° Regarde les zones o√π la courbe Rouge est situ√©e physiquement plus HAUT que la droite Bleue.",
            explanation: "La parabole rouge est au-dessus de la droite bleue √† l'ext√©rieur des points d'intersection, donc avant -1 et apr√®s 2."
        },
        // Q6
        {
            question: "Quel est le maximum de la fonction sur l'intervalle $[-2 ; 3]$ ?",
            plotConfig: {
                dataOverride: [
                    { fn: '-(x-1)^2 + 3', range: [-2, 3], color: '#dc2626', attr: { "stroke-width": 4 } },
                    { points: [[1, 3]], fnType: 'points', graphType: 'scatter', color: 'black', attr: {r: 5}, isHint: true }
                ],
                yAxis: { domain: [-5, 5] },
                xAxis: { domain: [-2, 3] }
            },
            options: [
                { text: "$1$", correct: false },
                { text: "$3$", correct: true },
                { text: "$0$", correct: false },
                { text: "$\\approx 2,5$", correct: false }
            ],
            hint: "üí° Le maximum est la plus grande valeur de $y$ atteinte par la courbe.",
            explanation: "Le point le plus haut de la courbe a pour ordonn√©e $y=3$. Il est atteint pour $x=1$."
        },
        // Q7
        {
            question: "On donne $f(x) = \\frac{2}{x-1}$. Quelle est l'image de $0$ ?",
            plotConfig: {
                data: [
                    { fn: '2/(x-1)', color: '#dc2626', attr: { "stroke-width": 4 }, skipTip: true },
                    { fn: '-1', color: '#000', attr: {'stroke-dasharray': '2,2'}, isHint: true }
                ],
                yAxis: { domain: [-5, 5] },
                xAxis: { domain: [-4, 6] }
            },
            options: [
                { text: "$0$", correct: false },
                { text: "$-2$", correct: true },
                { text: "$2$", correct: false },
                { text: "Non d√©fini", correct: false }
            ],
            hint: "üí° Remplace $x$ par $0$ dans la formule.",
            explanation: "$f(0) = \\frac{2}{0-1} = \\frac{2}{-1} = -2$."
        },
        // Q8 (Pi√®ge)
        {
            question: "Soit $f(x) = \\frac{6x}{x^2+2}$. Le point $A(3 ; 1,6)$ appartient-il √† la courbe ?",
            questionOverride: "Soit $f(x) = \\frac{6x}{x^2+2}$. Le point $A(3 ; 1,6)$ appartient-il √† la courbe ?",
            plotConfig: {
                data: [
                    { fn: '(6*x)/(x^2+2)', color: '#dc2626', attr: { "stroke-width": 4 } },
                    { points: [[3, 1.6]], fnType: 'points', graphType: 'scatter', color: 'blue', attr: {r: 5}, isHint: true }
                ],
                yAxis: { domain: [0, 3] },
                xAxis: { domain: [0, 6] }
            },
            options: [
                { text: "Oui, exactement", correct: false },
                { text: "Non", correct: true },
                { text: "On ne peut pas savoir", correct: false },
                { text: "Oui, car f(3) est positif", correct: false }
            ],
            hint: "üí° Calcule la valeur exacte de $f(3)$ et compare avec 1,6.",
            explanation: "$f(3) = \\frac{18}{11} \\approx 1,636$. Comme $1,636 \\neq 1,6$, le point n'est pas sur la courbe."
        },
        // Q9
        {
            question: "R√©soudre $f(x) = 4$ sachant que la courbe est une parabole $y=x^2$.",
            plotConfig: {
                data: [
                    { fn: 'x^2', color: '#dc2626', attr: { "stroke-width": 4 } },
                    { fn: '4', color: '#4b5563', attr: {'stroke-dasharray': '5,5'}, isHint: true }
                ],
                yAxis: { domain: [-1, 6] },
                xAxis: { domain: [-4, 4] }
            },
            options: [
                { text: "$x = 2$", correct: false },
                { text: "$x = -2$", correct: false },
                { text: "$x = 16$", correct: false },
                { text: "$x = -2$ ou $x = 2$", correct: true }
            ],
            hint: "üí° N'oublie pas les valeurs n√©gatives !",
            explanation: "Il y a deux nombres dont le carr√© est 4 : $2$ et $-2$."
        },
        // Q10
        {
            question: "Sur quel ensemble la fonction repr√©sent√©e est-elle strictement positive ($f(x) > 0$) ?",
            plotConfig: {
                data: [
                    { fn: '-0.2*(x+2)*(x-1)*(x-3)', color: '#dc2626', attr: { "stroke-width": 4 } },
                    { fn: '0', color: 'black', attr: { "stroke-width": 1 } }
                ],
                yAxis: { domain: [-5, 5] },
                xAxis: { domain: [-4, 5] }
            },
            options: [
                { text: "$]-2 ; 1[ \\cup ]3 ; +\\infty[$", correct: false },
                { text: "$]-\\infty ; -2[ \\cup ]1 ; 3[$", correct: true },
                { text: "$[-2 ; 1] \\cup [3 ; +\\infty[$", correct: false },
                { text: "$[1 ; 3]$", correct: false }
            ],
            hint: "üí° Cherche les zones o√π la courbe rouge est strictement AU-DESSUS de l'axe horizontal.",
            explanation: "La courbe est au-dessus de l'axe pour $x < -2$ et pour $x$ entre $1$ et $3$."
        }
    ];

    let currentQIndex = 0;
    let score = 0;
    let hasFailedCurrent = false;
    // On garde une trace des r√©ponses pour savoir si on doit montrer l'explication au retour
    let answersState = new Array(quizData.length).fill(null); 

    document.getElementById('total-q').innerText = quizData.length;

    function typesetMath() {
        if (window.MathJax) MathJax.typesetPromise().catch(err => console.log(err));
    }

    function loadQuestion() {
        const qData = quizData[currentQIndex];
        hasFailedCurrent = false; // Reset de l'√©tat "√©chec" pour le score si c'est une nouvelle tentative

        const qText = qData.questionOverride ? qData.questionOverride : qData.question;
        document.getElementById('question-text').innerHTML = qText;

        document.getElementById('current-q').innerText = currentQIndex + 1;
        document.getElementById('progress-bar').style.width = ((currentQIndex) / quizData.length * 100) + "%";

        // UI Reset
        const hintArea = document.getElementById('hint-area');
        const successArea = document.getElementById('success-area');
        hintArea.style.display = 'none';
        successArea.style.display = 'none';

        // Navigation
        const nextBtn = document.getElementById('btn-next');
        const prevBtn = document.getElementById('btn-prev');
        
        nextBtn.style.display = 'block';
        nextBtn.innerText = (currentQIndex === quizData.length - 1) ? "Voir R√©sultats üèÜ" : "Suivant ‚Üí";
        
        // MODIFICATION ICI : Bouton toujours actif
        nextBtn.disabled = false; 
        nextBtn.style.opacity = "1";

        prevBtn.style.display = (currentQIndex > 0) ? 'block' : 'none';

        // Options
        const optsDiv = document.getElementById('options-container');
        optsDiv.innerHTML = "";
        
        qData.options.forEach((opt, idx) => {
            const btn = document.createElement('button');
            btn.className = 'btn-option';
            btn.innerHTML = `<strong>${String.fromCharCode(65+idx)})</strong>&nbsp; ${opt.text}`;
            btn.onclick = () => checkAnswer(opt, btn);
            optsDiv.appendChild(btn);
        });

        // Visuel
        const visualArea = document.getElementById('visual-area');
        visualArea.innerHTML = ''; 
        // Si d√©j√† r√©pondu auparavant, on montre les indices
        const alreadyAnswered = answersState[currentQIndex] !== null;
        setTimeout(() => renderFunctionPlot(qData.plotConfig, alreadyAnswered), 50);

        typesetMath();
    }

    function renderFunctionPlot(config, showHints) {
        let dataToUse = config.dataOverride ? config.dataOverride : config.data;
        const filteredData = dataToUse.filter(item => showHints ? true : !item.isHint);
        
        const width = document.getElementById('visual-area').clientWidth;
        const height = document.getElementById('visual-area').clientHeight;

        functionPlot(Object.assign({}, config, {
            target: '#visual-area',
            width: width,
            height: height,
            grid: true,
            disableZoom: true,
            data: filteredData,
            tip: {
                xLine: true,
                yLine: true,
                renderer: function (x, y, index) { return `x: ${x.toFixed(2)}, y: ${y.toFixed(2)}`; }
            }
        }));
    }

    function checkAnswer(optionData, btnElement) {
        const hintArea = document.getElementById('hint-area');
        const successArea = document.getElementById('success-area');
        const qData = quizData[currentQIndex];

        // On marque la question comme r√©pondue
        answersState[currentQIndex] = optionData.correct;

        if (optionData.correct) {
            btnElement.classList.add('correct');
            document.querySelectorAll('.btn-option').forEach(b => b.disabled = true);
            
            hintArea.style.display = 'none';
            successArea.innerHTML = `<strong>‚úÖ Exact !</strong><br>${qData.explanation}`;
            successArea.style.display = 'block';
            typesetMath();

            if (!hasFailedCurrent) {
                score++;
                document.getElementById('current-score-display').innerText = score;
            }
            renderFunctionPlot(qData.plotConfig, true);

        } else {
            hasFailedCurrent = true;
            btnElement.classList.add('wrong');
            btnElement.disabled = true;
            hintArea.innerHTML = qData.hint;
            hintArea.style.display = 'block';
            renderFunctionPlot(qData.plotConfig, true);
            typesetMath();
        }
    }

    function nextQuestion() {
        if (currentQIndex < quizData.length - 1) {
            currentQIndex++;
            loadQuestion();
        } else {
            showResults();
        }
    }

    function prevQuestion() {
        if (currentQIndex > 0) {
            currentQIndex--;
            loadQuestion();
        }
    }

    function showResults() {
        document.getElementById('quiz-area').style.display = 'none';
        document.getElementById('result-area').style.display = 'block';
        document.getElementById('final-score').innerText = `${score}`;
        document.getElementById('progress-bar').style.width = "100%";
        
        const percentage = (score / quizData.length) * 100;
        document.getElementById('score-circle').style.background = 
            `conic-gradient(var(--primary) ${percentage}%, #374151 ${percentage}%)`;

        let comment = "";
        if(score === quizData.length) comment = "üëë Cerveau Galactique !";
        else if(score >= 8) comment = "üî• Excellent niveau !";
        else if(score >= 5) comment = "üëç Bien jou√©, c'√©tait dur.";
        else comment = "üíÄ Ouch... Le niveau est √©lev√© !";
        
        document.getElementById('comment-score').innerText = comment;
    }

    window.addEventListener('resize', () => {
        const qData = quizData[currentQIndex];
        // On check si on doit montrer les indices
        const isAnswered = document.querySelector('.btn-option.correct') || document.querySelector('.btn-option.wrong');
        renderFunctionPlot(qData.plotConfig, !!isAnswered);
    });
    
    window.onload = loadQuestion;
</script>

</body>
</html>
