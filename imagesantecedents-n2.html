<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QCM Maths 2de : Niveau Avanc√©</title>
    <script>
        window.MathJax = {
            tex: { inlineMath: [['$', '$'], ['\\(', '\\)']] },
            startup: { typeset: false }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="https://unpkg.com/d3@3/d3.min.js"></script>
    <script src="https://unpkg.com/function-plot@1/dist/function-plot.js"></script>
    <style>
        :root {
            /* Th√®me Indigo / Avanc√© */
            --primary: #4338ca; 
            --primary-hover: #3730a3;
            --bg: #f0f2f5;
            --card: #ffffff;
            --text: #1f2937;
            --text-muted: #6b7280;
            --success-bg: #dcfce7;
            --success-text: #166534;
            --danger-bg: #fee2e2;
            --danger-text: #991b1b;
            --hint-bg: #fff7ed;
            --hint-text: #9a3412;
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .container {
            background: var(--card);
            width: 100%;
            max-width: 900px;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            padding: 30px;
        }

        header { text-align: center; margin-bottom: 25px; }
        h1 { color: var(--primary); font-size: 1.6rem; margin: 0 0 10px 0; font-weight: 700; }

        .progress-container {
            background-color: #e5e7eb;
            border-radius: 99px;
            height: 8px;
            width: 100%;
            margin-bottom: 15px;
            overflow: hidden;
        }
        .progress-bar {
            background-color: var(--primary);
            height: 100%;
            width: 0%;
            transition: width 0.3s ease;
        }

        /* --- ZONE VISUELLE --- */
        .visual-container {
            width: 100%;
            height: 380px;
            margin: 0 auto 25px auto;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            background: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            position: relative;
        }

        .function-plot .grid .tick line { stroke: #e5e7eb !important; stroke-width: 1px; }
        .function-plot .axis path.domain { stroke: #374151 !important; stroke-width: 2px; }
        .function-plot .axis text { fill: #374151 !important; font-size: 13px !important; font-weight: 600; }

        /* --- INTERFACE QUIZ --- */
        .question-text { font-size: 1.25rem; font-weight: 600; margin-bottom: 20px; text-align: center; color: var(--text); }
        .options-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 20px; }
        @media (max-width: 600px) { .options-grid { grid-template-columns: 1fr; } }

        .btn-option {
            background: white; border: 2px solid #e5e7eb; padding: 15px;
            border-radius: 8px; cursor: pointer; font-size: 1rem; color: var(--text);
            transition: all 0.2s; text-align: left;
        }
        .btn-option:hover:not(:disabled) { border-color: var(--primary); background-color: #eef2ff; }
        .btn-option.correct { background-color: var(--success-bg); border-color: #22c55e; color: var(--success-text); }
        .btn-option.wrong { background-color: var(--danger-bg); border-color: #ef4444; color: var(--danger-text); opacity: 0.8; }

        .feedback { padding: 15px; border-radius: 8px; margin-top: 15px; display: none; line-height: 1.5; font-size: 0.95rem;}
        .feedback.hint { background-color: var(--hint-bg); border-left: 4px solid #f97316; color: var(--hint-text); }
        .feedback.success { background-color: var(--success-bg); border-left: 4px solid #22c55e; color: var(--success-text); }

        .controls { display: flex; justify-content: space-between; margin-top: 20px; height: 50px; }
        .btn-nav { color: white; border: none; padding: 12px 24px; border-radius: 6px; font-size: 1rem; cursor: pointer; transition: background 0.2s; font-weight: 600;}
        .btn-next { background-color: var(--primary); }
        .btn-next:hover { background-color: var(--primary-hover); }
        .btn-prev { background-color: #9ca3af; display: none; }
        .btn-prev:hover { background-color: #6b7280; }

        .result-screen { text-align: center; display: none; padding: 40px 0; }
        .score-circle {
            width: 150px; height: 150px; border-radius: 50%;
            background: conic-gradient(var(--primary) 0%, #e5e7eb 0%);
            display: flex; justify-content: center; align-items: center;
            margin: 0 auto 30px auto;
        }
        .score-inner {
            width: 130px; height: 130px; background: white; border-radius: 50%;
            display: flex; justify-content: center; align-items: center;
            font-size: 2.5rem; font-weight: bold; color: var(--primary);
        }
        .btn-restart {
            background-color: var(--text); color: white; border: none;
            padding: 12px 24px; border-radius: 8px; cursor: pointer; font-size: 1.1rem;
        }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>üéØ Fonctions : Niveau Avanc√©</h1>
        <div class="progress-container">
            <div class="progress-bar" id="progress-bar"></div>
        </div>
        <div style="display:flex; justify-content:space-between; color: var(--text-muted); font-size: 0.9rem;">
            <span>Score: <strong id="current-score-display">0</strong></span>
            <span>Question <span id="current-q">1</span> / <span id="total-q"></span></span>
        </div>
    </header>

    <div id="quiz-area">
        <div class="question-text" id="question-text"></div>
        <div class="visual-container" id="visual-area"></div>
        <div class="options-grid" id="options-container"></div>
        <div class="feedback hint" id="hint-area"></div>
        <div class="feedback success" id="success-area"></div>
        <div class="controls">
            <button class="btn-nav btn-prev" id="btn-prev" onclick="prevQuestion()">‚Üê Retour</button>
            <button class="btn-nav btn-next" id="btn-next" onclick="nextQuestion()">Suivant ‚Üí</button>
        </div>
    </div>

    <div id="result-area" class="result-screen">
        <h2>Quiz Termin√© !</h2>
        <p>Ton score final :</p>
        <div class="score-circle" id="score-circle">
            <div class="score-inner" id="final-score"></div>
        </div>
        <p id="comment-score" style="font-size: 1.2rem; margin-bottom: 30px; color: var(--text-muted);"></p>
        <button class="btn-restart" onclick="location.reload()">Recommencer</button>
    </div>
</div>

<script>
    const quizData = [
        // Q1 : Intersection f(x) = g(x)
        {
            question: "R√©soudre graphiquement l'√©quation $f(x) = g(x)$.",
            plotConfig: {
                data: [
                     { fn: '0.5*x^2 - 2', color: '#4338ca', attr: { "stroke-width": 3 }, title: 'f(x) (Parabole)' }, 
                     { fn: '0.5*x - 1', color: '#0ea5e9', attr: { "stroke-width": 3 }, title: 'g(x) (Droite)' },
                     { points: [[-1, -1.5], [2, 0]], fnType: 'points', graphType: 'scatter', color: 'black', attr: {r: 5}, isHint: true }
                ],
                yAxis: { domain: [-4, 4] },
                xAxis: { domain: [-4, 5] }
            },
            options: [
                { text: "$S = \\{-1,5 ; 0\\}$", correct: false },
                { text: "$S = \\{-1 ; 2\\}$", correct: true },
                { text: "$S = [-1 ; 2]$", correct: false },
                { text: "$S = \\emptyset$", correct: false }
            ],
            hint: "üí° On cherche les abscisses ($x$) des points d'intersection entre la courbe violette et la droite bleue.",
            explanation: "Les deux courbes se croisent aux points d'abscisses $x = -1$ et $x = 2$."
        },
        // Q2 : Nombre de solutions (courbe polynomiale complexe)
        {
            question: "Combien l'√©quation $f(x) = 1$ admet-elle de solutions ?",
            plotConfig: {
                data: [
                    { fn: '0.2*(x+2)*(x-1)*(x-3)*(x+1) + 1.5', color: '#4338ca', attr: { "stroke-width": 3 } },
                    { fn: '1', color: '#9ca3af', attr: {'stroke-dasharray': '5,5'}, isHint: true }
                ],
                yAxis: { domain: [-2, 5] },
                xAxis: { domain: [-4, 4] }
            },
            options: [
                { text: "2 solutions", correct: false },
                { text: "3 solutions", correct: false },
                { text: "4 solutions", correct: true },
                { text: "0 solution", correct: false }
            ],
            hint: "üí° Trace mentalement une ligne horizontale √† la hauteur $y=1$.",
            explanation: "La droite horizontale $y=1$ coupe la courbe en 4 points distincts."
        },
        // Q3 : Position relative f(x) >= g(x)
        {
            question: "Sur quel ensemble a-t-on $f(x) \\ge g(x)$ ? (Parabole au-dessus de Droite)",
            plotConfig: {
                data: [
                     { fn: '0.5*x^2 - 2', color: '#4338ca', attr: { "stroke-width": 3 } }, 
                     { fn: '0.5*x - 1', color: '#0ea5e9', attr: { "stroke-width": 3 } },
                     // Zones colori√©es en indice
                     { fn: '0.5*x^2 - 2', range: [-5, -1], color: 'rgba(67, 56, 202, 0.2)', closed: true, isHint: true },
                     { fn: '0.5*x^2 - 2', range: [2, 5], color: 'rgba(67, 56, 202, 0.2)', closed: true, isHint: true }
                ],
                yAxis: { domain: [-4, 5] },
                xAxis: { domain: [-4, 5] }
            },
            options: [
                { text: "$[-1 ; 2]$", correct: false },
                { text: "$]-\\infty ; -1] \\cup [2 ; +\\infty[$", correct: true },
                { text: "$[2 ; +\\infty[$", correct: false },
                { text: "$]-\\infty ; -1]$", correct: false }
            ],
            hint: "üí° Regarde o√π la courbe violette est situ√©e physiquement plus HAUT que la droite bleue.",
            explanation: "La parabole est au-dessus de la droite √† l'ext√©rieur des racines, c'est-√†-dire avant -1 et apr√®s 2."
        },
        // Q4 : Calcul d'image avec racine
        {
            question: "Calculer l'image de $-3$ par la fonction $f(x) = \\sqrt{x^2 + 7}$.",
            plotConfig: {
                data: [
                    { fn: 'sqrt(x^2 + 7)', color: '#4338ca', attr: { "stroke-width": 3 }, skipTip: true },
                    { points: [[-3, 4]], fnType: 'points', graphType: 'scatter', color: 'black', attr: {r: 5}, isHint: true }
                ],
                yAxis: { domain: [0, 6] },
                xAxis: { domain: [-5, 5] }
            },
            options: [
                { text: "$4$", correct: true },
                { text: "$\\sqrt{1}$", correct: false },
                { text: "$2$", correct: false },
                { text: "$16$", correct: false }
            ],
            hint: "üí° Remplace $x$ par $-3$. Attention : $(-3)^2$ est positif !",
            explanation: "$f(-3) = \\sqrt{(-3)^2 + 7} = \\sqrt{9 + 7} = \\sqrt{16} = 4$."
        },
        // Q5 : In√©quation f(x) > 0 avec Union
        {
            question: "R√©soudre graphiquement l'in√©quation $f(x) > 0$.",
            plotConfig: {
                data: [
                    // Racines en -2, 1, 3. f(x) = -(x+2)(x-1)(x-3)
                    { fn: '-0.2*(x+2)*(x-1)*(x-3)', color: '#4338ca', attr: { "stroke-width": 3 } },
                    { fn: '0', color: 'black', attr: {'stroke-width': 1} }
                ],
                yAxis: { domain: [-4, 4] },
                xAxis: { domain: [-4, 5] }
            },
            options: [
                { text: "$]-2 ; 1[$", correct: false },
                { text: "$]-\\infty ; -2[ \\cup ]1 ; 3[$", correct: true },
                { text: "$[1 ; 3]$", correct: false },
                { text: "$]-2 ; 1[ \\cup ]3 ; +\\infty[$", correct: false }
            ],
            hint: "üí° Cherche les intervalles o√π la courbe est strictement au-dessus de l'axe des abscisses.",
            explanation: "La courbe est positive avant -2 et entre 1 et 3."
        },
        // Q6 : Calcul alg√©brique avec fraction
        {
            question: "Soit $f(x) = 1 - \\frac{3}{x}$. Quelle est l'image de $\\frac{1}{2}$ ?",
            plotConfig: {
                data: [
                    { fn: '1 - 3/x', color: '#4338ca', attr: { "stroke-width": 3 }, skipTip: true },
                    { points: [[0.5, -5]], fnType: 'points', graphType: 'scatter', color: 'black', attr: {r: 5}, isHint: true }
                ],
                yAxis: { domain: [-8, 4] },
                xAxis: { domain: [-2, 4] }
            },
            options: [
                { text: "$-5$", correct: true },
                { text: "$0,5$", correct: false },
                { text: "$-2$", correct: false },
                { text: "$7$", correct: false }
            ],
            hint: "üí° Calcul : $f(0,5) = 1 - \\frac{3}{0,5}$. Rappel : diviser par $0,5$ revient √† multiplier par 2.",
            explanation: "$f(\\frac{1}{2}) = 1 - (3 \\div 0,5) = 1 - 6 = -5$."
        },
        // Q7 : Image de 0 (Fonction rationnelle)
        {
            question: "On donne $f(x) = \\frac{2}{x-1}$. Quelle est l'image de $0$ ?",
            plotConfig: {
                data: [
                    { fn: '2/(x-1)', color: '#4338ca', attr: { "stroke-width": 3 }, skipTip: true },
                    { fn: '-1', color: '#000', attr: {'stroke-dasharray': '2,2'}, isHint: true }
                ],
                yAxis: { domain: [-5, 5] },
                xAxis: { domain: [-4, 6] }
            },
            options: [
                { text: "$0$", correct: false },
                { text: "$-2$", correct: true },
                { text: "$2$", correct: false },
                { text: "Non d√©fini", correct: false }
            ],
            hint: "üí° Remplace $x$ par $0$ dans la formule.",
            explanation: "$f(0) = \\frac{2}{0-1} = \\frac{2}{-1} = -2$."
        },
        // Q8 : Le Pi√®ge du Point (Appartenance)
        {
            question: "Soit $f(x) = \\frac{6x}{x^2+2}$. Le point $A(3 ; 1,6)$ appartient-il √† la courbe ?",
            questionOverride: "Soit $f(x) = \\frac{6x}{x^2+2}$. Le point $A(3 ; 1,6)$ appartient-il √† la courbe ?",
            plotConfig: {
                data: [
                    { fn: '(6*x)/(x^2+2)', color: '#4338ca', attr: { "stroke-width": 3 } },
                    { points: [[3, 1.6]], fnType: 'points', graphType: 'scatter', color: '#db2777', attr: {r: 5}, isHint: true }
                ],
                yAxis: { domain: [0, 3] },
                xAxis: { domain: [0, 6] }
            },
            options: [
                { text: "Oui", correct: false },
                { text: "Non", correct: true },
                { text: "On ne peut pas savoir", correct: false },
                { text: "Oui, c'est visible", correct: false }
            ],
            hint: "üí° Ne te fie pas √† tes yeux. Calcule $f(3)$ (en fraction) et compare avec $1,6$.",
            explanation: "$f(3) = \\frac{18}{9+2} = \\frac{18}{11} \\approx 1,636$.<br>Comme $1,636 \\neq 1,6$, le point n'est pas sur la courbe."
        },
        // Q9 : Ant√©c√©dent carr√©
        {
            question: "R√©soudre $f(x) = 4$ sachant que la courbe est une parabole $y=x^2$.",
            plotConfig: {
                data: [
                    { fn: 'x^2', color: '#4338ca', attr: { "stroke-width": 3 } },
                    { fn: '4', color: '#9ca3af', attr: {'stroke-dasharray': '5,5'}, isHint: true }
                ],
                yAxis: { domain: [-1, 6] },
                xAxis: { domain: [-4, 4] }
            },
            options: [
                { text: "$x = 2$", correct: false },
                { text: "$x = -2$", correct: false },
                { text: "$x = 16$", correct: false },
                { text: "$x = -2$ ou $x = 2$", correct: true }
            ],
            hint: "üí° N'oublie pas qu'un nombre n√©gatif au carr√© donne aussi un r√©sultat positif.",
            explanation: "Il y a deux nombres dont le carr√© est 4 : $2$ et $-2$."
        },
        // Q10 : Tableau de signes (Lecture graphique)
        {
            question: "Sur quel ensemble a-t-on $f(x) \\le 0$ ?",
            plotConfig: {
                data: [
                    // Racines √† -1, 2. Parabole tourn√©e vers le haut.
                    { fn: '(x+1)*(x-2)', color: '#4338ca', attr: { "stroke-width": 3 } },
                    { fn: '(x+1)*(x-2)', range: [-1, 2], closed:true, color: 'rgba(67, 56, 202, 0.2)', isHint: true }
                ],
                yAxis: { domain: [-3, 5] },
                xAxis: { domain: [-3, 4] }
            },
            options: [
                { text: "$[-1 ; 2]$", correct: true },
                { text: "$]-\\infty ; -1] \\cup [2 ; +\\infty[$", correct: false },
                { text: "$[2 ; +\\infty[$", correct: false },
                { text: "$[-2 ; 1]$", correct: false }
            ],
            hint: "üí° On cherche la zone o√π la courbe est EN DESSOUS (ou sur) l'axe horizontal.",
            explanation: "La courbe est en dessous de l'axe entre ses racines -1 et 2."
        }
    ];

    let currentQIndex = 0;
    let score = 0;
    let hasFailedCurrent = false;
    let answersState = new Array(quizData.length).fill(null); 

    document.getElementById('total-q').innerText = quizData.length;

    function typesetMath() {
        if (window.MathJax) MathJax.typesetPromise().catch(err => console.log(err));
    }

    function loadQuestion() {
        const qData = quizData[currentQIndex];
        hasFailedCurrent = false; 

        const qText = qData.questionOverride ? qData.questionOverride : qData.question;
        document.getElementById('question-text').innerHTML = qText;

        document.getElementById('current-q').innerText = currentQIndex + 1;
        document.getElementById('progress-bar').style.width = ((currentQIndex) / quizData.length * 100) + "%";

        const hintArea = document.getElementById('hint-area');
        const successArea = document.getElementById('success-area');
        hintArea.style.display = 'none';
        successArea.style.display = 'none';

        const nextBtn = document.getElementById('btn-next');
        const prevBtn = document.getElementById('btn-prev');
        
        nextBtn.style.display = 'block';
        nextBtn.innerText = (currentQIndex === quizData.length - 1) ? "Voir R√©sultats üèÜ" : "Suivant ‚Üí";
        nextBtn.disabled = false; 
        nextBtn.style.opacity = "1";

        prevBtn.style.display = (currentQIndex > 0) ? 'block' : 'none';

        const optsDiv = document.getElementById('options-container');
        optsDiv.innerHTML = "";
        
        qData.options.forEach((opt, idx) => {
            const btn = document.createElement('button');
            btn.className = 'btn-option';
            btn.innerHTML = `<strong>${String.fromCharCode(65+idx)})</strong>&nbsp; ${opt.text}`;
            btn.onclick = () => checkAnswer(opt, btn);
            optsDiv.appendChild(btn);
        });

        const visualArea = document.getElementById('visual-area');
        visualArea.innerHTML = ''; 
        
        const alreadyAnswered = answersState[currentQIndex] !== null;
        setTimeout(() => renderFunctionPlot(qData.plotConfig, alreadyAnswered), 50);

        typesetMath();
    }

    function renderFunctionPlot(config, showHints) {
        let dataToUse = config.dataOverride ? config.dataOverride : config.data;
        const filteredData = dataToUse.filter(item => showHints ? true : !item.isHint);
        
        const width = document.getElementById('visual-area').clientWidth;
        const height = document.getElementById('visual-area').clientHeight;

        functionPlot(Object.assign({}, config, {
            target: '#visual-area',
            width: width,
            height: height,
            grid: true,
            disableZoom: true,
            data: filteredData,
            tip: {
                xLine: true,
                yLine: true,
                renderer: function (x, y, index) { return `x: ${x.toFixed(2)}, y: ${y.toFixed(2)}`; }
            }
        }));
    }

    function checkAnswer(optionData, btnElement) {
        const hintArea = document.getElementById('hint-area');
        const successArea = document.getElementById('success-area');
        const qData = quizData[currentQIndex];

        answersState[currentQIndex] = optionData.correct;

        if (optionData.correct) {
            btnElement.classList.add('correct');
            document.querySelectorAll('.btn-option').forEach(b => b.disabled = true);
            
            hintArea.style.display = 'none';
            successArea.innerHTML = `<strong>‚úÖ Exact !</strong><br>${qData.explanation}`;
            successArea.style.display = 'block';
            typesetMath();

            if (!hasFailedCurrent) {
                score++;
                document.getElementById('current-score-display').innerText = score;
            }
            renderFunctionPlot(qData.plotConfig, true);

        } else {
            hasFailedCurrent = true;
            btnElement.classList.add('wrong');
            btnElement.disabled = true;
            hintArea.innerHTML = qData.hint;
            hintArea.style.display = 'block';
            renderFunctionPlot(qData.plotConfig, true);
            typesetMath();
        }
    }

    function nextQuestion() {
        if (currentQIndex < quizData.length - 1) {
            currentQIndex++;
            loadQuestion();
        } else {
            showResults();
        }
    }

    function prevQuestion() {
        if (currentQIndex > 0) {
            currentQIndex--;
            loadQuestion();
        }
    }

    function showResults() {
        document.getElementById('quiz-area').style.display = 'none';
        document.getElementById('result-area').style.display = 'block';
        document.getElementById('final-score').innerText = `${score}`;
        document.getElementById('progress-bar').style.width = "100%";
        
        const percentage = (score / quizData.length) * 100;
        document.getElementById('score-circle').style.background = 
            `conic-gradient(var(--primary) ${percentage}%, #e5e7eb ${percentage}%)`;

        let comment = "";
        if(score === quizData.length) comment = "ü•á Excellent travail !";
        else if(score >= 8) comment = "ü•à Tr√®s bon niveau !";
        else if(score >= 5) comment = "ü•â Bien jou√© !";
        else comment = "üí™ Courage, continue !";
        
        document.getElementById('comment-score').innerText = comment;
    }

    window.addEventListener('resize', () => {
        const qData = quizData[currentQIndex];
        const isAnswered = document.querySelector('.btn-option.correct') || document.querySelector('.btn-option.wrong');
        renderFunctionPlot(qData.plotConfig, !!isAnswered);
    });
    
    window.onload = loadQuestion;
</script>

</body>
</html>
