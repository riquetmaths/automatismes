<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QCM Maths 2de : Lecture Graphique (Expert)</title>
    <script>
        window.MathJax = {
            tex: { inlineMath: [['$', '$'], ['\\(', '\\)']] },
            startup: { typeset: false }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="https://unpkg.com/d3@3/d3.min.js"></script>
    <script src="https://unpkg.com/function-plot@1/dist/function-plot.js"></script>
    <style>
        :root {
            --primary: #5b21b6;
            --primary-hover: #4c1d95;
            --bg: #f3f4f6;
            --card: #ffffff;
            --text: #111827;
            --text-muted: #6b7280;
            --success-bg: #dcfce7;
            --success-text: #166534;
            --danger-bg: #fee2e2;
            --danger-text: #991b1b;
            --hint-bg: #ffedd5;
            --hint-text: #9a3412;
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .container {
            background: var(--card);
            width: 100%;
            max-width: 900px;
            border-radius: 12px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            padding: 30px;
            border: 1px solid #e5e7eb;
        }

        header { text-align: center; margin-bottom: 25px; }
        h1 { color: var(--primary); font-size: 1.6rem; margin: 0 0 10px 0; font-weight: 700; }

        .progress-container {
            background-color: #e5e7eb;
            border-radius: 99px;
            height: 8px;
            width: 100%;
            margin-bottom: 15px;
            overflow: hidden;
        }
        .progress-bar {
            background-color: var(--primary);
            height: 100%;
            width: 0%;
            transition: width 0.3s ease;
        }

        /* --- ZONE VISUELLE --- */
        .visual-container {
            width: 100%;
            height: 380px;
            margin: 0 auto 25px auto;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            background: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            position: relative;
        }

        .function-plot .grid .tick line { stroke: #e5e7eb !important; stroke-width: 1px; }
        .function-plot .axis path.domain { stroke: #374151 !important; stroke-width: 2px; }
        .function-plot .axis text { fill: #374151 !important; font-size: 13px !important; font-weight: 600; }

        /* --- INTERFACE QUIZ --- */
        .question-text { font-size: 1.25rem; font-weight: 600; margin-bottom: 20px; text-align: center; color: var(--text); }
        .options-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 20px; }
        @media (max-width: 600px) { .options-grid { grid-template-columns: 1fr; } }

        .btn-option {
            background: white; border: 2px solid #e5e7eb; padding: 15px;
            border-radius: 8px; cursor: pointer; font-size: 1rem; color: var(--text);
            transition: all 0.2s; text-align: left;
        }
        .btn-option:hover:not(:disabled) { border-color: var(--primary); background-color: #f5f3ff; }
        .btn-option.correct { background-color: var(--success-bg); border-color: #22c55e; color: var(--success-text); }
        .btn-option.wrong { background-color: var(--danger-bg); border-color: #ef4444; color: var(--danger-text); opacity: 0.8; }

        .feedback { padding: 15px; border-radius: 8px; margin-top: 15px; display: none; line-height: 1.5; font-size: 0.95rem;}
        .feedback.hint { background-color: var(--hint-bg); border-left: 4px solid #f97316; color: var(--hint-text); }
        .feedback.success { background-color: var(--success-bg); border-left: 4px solid #22c55e; color: var(--success-text); }

        .controls { display: flex; justify-content: space-between; margin-top: 20px; height: 50px; }
        .btn-nav { color: white; border: none; padding: 0 24px; border-radius: 6px; font-size: 1rem; cursor: pointer; transition: background 0.2s; font-weight: 600; display: flex; align-items: center;}
        .btn-next { background-color: var(--primary); }
        .btn-next:hover { background-color: var(--primary-hover); }
        .btn-prev { background-color: #9ca3af; display: none; }
        .btn-prev:hover { background-color: #6b7280; }

        .result-screen { text-align: center; display: none; padding: 40px 0; }
        .score-circle {
            width: 150px; height: 150px; border-radius: 50%;
            background: conic-gradient(var(--primary) 0%, #e5e7eb 0%);
            display: flex; justify-content: center; align-items: center;
            margin: 0 auto 30px auto;
        }
        .score-inner {
            width: 130px; height: 130px; background: white; border-radius: 50%;
            display: flex; justify-content: center; align-items: center;
            font-size: 2.5rem; font-weight: bold; color: var(--primary);
        }
        .btn-restart {
            background-color: var(--text); color: white; border: none;
            padding: 12px 24px; border-radius: 8px; cursor: pointer; font-size: 1.1rem;
        }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>üéØ Fonctions : Lectures Graphiques</h1>
        <div class="progress-container">
            <div class="progress-bar" id="progress-bar"></div>
        </div>
        <div style="display:flex; justify-content:space-between; color: var(--text-muted); font-size: 0.9rem;">
            <span>Score: <strong id="current-score-display">0</strong></span>
            <span>Question <span id="current-q">1</span> / <span id="total-q"></span></span>
        </div>
    </header>

    <div id="quiz-area">
        <div class="question-text" id="question-text"></div>
        <div class="visual-container" id="visual-area"></div>
        <div class="options-grid" id="options-container"></div>
        <div class="feedback hint" id="hint-area"></div>
        <div class="feedback success" id="success-area"></div>
        <div class="controls">
            <button class="btn-nav btn-prev" id="btn-prev" onclick="prevQuestion()">‚Üê Retour</button>
            <button class="btn-nav btn-next" id="btn-next" onclick="nextQuestion()">Suivant ‚Üí</button>
        </div>
    </div>

    <div id="result-area" class="result-screen">
        <h2>D√©fi Termin√© !</h2>
        <p>Ton score final :</p>
        <div class="score-circle" id="score-circle">
            <div class="score-inner" id="final-score"></div>
        </div>
        <p id="comment-score" style="font-size: 1.2rem; margin-bottom: 30px; color: var(--text-muted);"></p>
        <button class="btn-restart" onclick="location.reload()">Recommencer</button>
    </div>
</div>

<script>
    // --- GESTION DES COURBES "MAIN LEV√âE" ---
    
    function getCurveData(points, stepsPerSegment = 25) {
        let data = [];
        points.sort((a, b) => a[0] - b[0]);
        for (let i = 0; i < points.length - 1; i++) {
            let p0 = points[i];
            let p1 = points[i+1];
            for (let j = 0; j <= stepsPerSegment; j++) {
                let mu = j / stepsPerSegment;
                let mu2 = (1 - Math.cos(mu * Math.PI)) / 2; // Interpolation Cosinus
                let x = p0[0] * (1 - mu) + p1[0] * mu;
                let y = p0[1] * (1 - mu2) + p1[1] * mu2;
                data.push([x, y]);
            }
        }
        return data;
    }

    // Donn√©es pour la Question 1 (Image)
    // Point (-3, 2) comme leurre
    const q1Points = [
        [-4, -0.5], 
        [-3, 2],    // Point pi√®ge demand√©
        [-1, -2], 
        [2, 3],     // La vraie r√©ponse
        [4, 0]
    ];
    const q1Curve = getCurveData(q1Points);

    // Donn√©es pour la Question 7 (Ant√©c√©dent)
    // Le point (2,0) est conserv√© comme pi√®ge
    const q7Points = [
        [-4, 1], 
        [-2, 4],  
        [1, -2],  
        [2, 0],   // Point pi√®ge
        [3, 2],   // La r√©ponse exacte
        [5, 0]
    ];
    const q7Curve = getCurveData(q7Points);


    // --- DONN√âES DU QUIZ ---

    const quizData = [
        // Q1 : Lecture d'image sur Courbe "Main Lev√©e"
        {
            question: "Quelle est l'image de $2$ par la fonction repr√©sent√©e ?",
            plotConfig: {
                data: [
                    { points: q1Curve, fnType: 'points', graphType: 'polyline', color: '#5b21b6', attr: { "stroke-width": 3 } },
                    { points: q1Points, fnType: 'points', graphType: 'scatter', color: 'black', attr: {r: 4} },
                    { points: [[2, 3]], fnType: 'points', graphType: 'scatter', color: '#db2777', attr: {r: 5}, isHint: true }, 
                    { fn: '0', color: '#9ca3af', attr: {'stroke-dasharray': '2,2'}, range: [-5, 5], isHint: true }
                ],
                yAxis: { domain: [-3, 4] },
                xAxis: { domain: [-4, 4] }
            },
            options: [
                { text: "$3$", correct: true },
                { text: "$-3$", correct: false }, // Pi√®ge correspondant au point (-3, 2)
                { text: "$2$", correct: false },
                { text: "$0$", correct: false }
            ],
            hint: "üí° Cherche $x=2$ sur l'axe horizontal, monte jusqu'au point noir sur la courbe et lis son ordonn√©e.",
            explanation: "La courbe passe par le point $(2 ; 3)$. L'image de $2$ est donc $3$. (Attention : $-3$ est l'abscisse d'un point qui a pour hauteur 2, ce n'est pas ce qu'on cherche)."
        },

        // Q2 : R√©solution f(x) = k
        {
            question: "R√©soudre graphiquement l'√©quation $f(x) = 2$.",
            plotConfig: {
                data: [
                    { fn: 'x^2 - 2', color: '#5b21b6', attr: { "stroke-width": 3 } },
                    { fn: '2', color: '#000', attr: {'stroke-dasharray': '5,5'}, isHint: true }
                ],
                yAxis: { domain: [-3, 6] },
                xAxis: { domain: [-4, 4] }
            },
            options: [
                { text: "$S = \\{2\\}$", correct: false },
                { text: "$S = \\{-2 ; 2\\}$", correct: true },
                { text: "$S = \\{0\\}$", correct: false },
                { text: "$S = \\emptyset$", correct: false }
            ],
            hint: "üí° Trace mentalement une ligne horizontale √† la hauteur $y=2$. Quels sont les $x$ des points d'intersection ?",
            explanation: "La droite $y=2$ coupe la parabole en deux points d'abscisses $-2$ et $2$."
        },

        // Q3 : In√©quation f(x) <= 0
        {
            question: "Sur quel intervalle a-t-on $f(x) \\le 0$ ?",
            plotConfig: {
                data: [
                    { fn: '(x+1)*(x-3)', color: '#5b21b6', attr: { "stroke-width": 3 } },
                    { fn: '0', color: 'black', attr: { "stroke-width": 1 } }
                ],
                yAxis: { domain: [-5, 5] },
                xAxis: { domain: [-2, 5] }
            },
            options: [
                { text: "$[-1 ; 3]$", correct: true },
                { text: "$]-\\infty ; -1] \\cup [3 ; +\\infty[$", correct: false },
                { text: "$[0 ; 3]$", correct: false },
                { text: "$[-4 ; 0]$", correct: false }
            ],
            hint: "üí° Cherche la partie de la courbe situ√©e EN DESSOUS de l'axe horizontal.",
            explanation: "La courbe est sous l'axe des abscisses entre ses deux racines $x=-1$ et $x=3$."
        },

        // Q4 : PI√àGE - Confusion Image/Ant√©c√©dent
        {
            question: "Quelle est l'image de $0$ par cette fonction ?",
            plotConfig: {
                data: [
                    { fn: '-x^2 + 4', color: '#5b21b6', attr: { "stroke-width": 3 } },
                    { 
                        points: [[0, 4], [2, 0], [-2, 0]], 
                        fnType: 'points', graphType: 'scatter', color: 'black', attr: {r: 5}
                    }
                ],
                yAxis: { domain: [-2, 6] },
                xAxis: { domain: [-4, 4] }
            },
            options: [
                { text: "$4$", correct: true },
                { text: "$2$", correct: false },
                { text: "$-2$", correct: false },
                { text: "$0$", correct: false }
            ],
            hint: "üí° On cherche l'image de 0, c'est-√†-dire $f(0)$. Regarde sur l'axe vertical. Ne confonds pas avec les ant√©c√©dents !",
            explanation: "L'image de $0$ se lit sur l'axe des ordonn√©es. La courbe passe par le sommet $(0 ; 4)$."
        },

        // Q5 : Appartenance d'un point
        {
            question: "Le point $A(4 ; 15)$ appartient-il √† la courbe repr√©sent√©e ci-dessous ?",
            plotConfig: {
                data: [
                    { fn: 'x^2 - 2', color: '#5b21b6', attr: { "stroke-width": 3 } },
                    { points: [[4, 15]], fnType: 'points', graphType: 'scatter', color: '#db2777', attr: {r: 5}, isHint: true }
                ],
                yAxis: { domain: [-5, 20] },
                xAxis: { domain: [-5, 6] }
            },
            options: [
                { text: "Oui", correct: false },
                { text: "Non", correct: true },
                { text: "On ne peut pas savoir", correct: false },
                { text: "Oui, c'est visible", correct: false }
            ],
            hint: "üí° Regarde attentivement la position du point rose par rapport au trac√© violet.",
            explanation: "Le point n'est pas sur la courbe. (Calcul r√©el : $4^2 - 2 = 14$, donc le point $(4;15)$ est au-dessus)."
        },

        // Q6 : In√©quation f(x) > k
        {
            question: "R√©soudre graphiquement l'in√©quation $f(x) > 3$.",
            plotConfig: {
                data: [
                    { fn: '-(x-2)^2 + 4', color: '#5b21b6', attr: { "stroke-width": 3 } },
                    { fn: '3', color: '#000', attr: {'stroke-dasharray': '5,5'}, isHint: true },
                    { fn: '-(x-2)^2 + 4', range: [1, 3], color: 'rgba(91, 33, 182, 0.2)', closed: true, isHint: true }
                ],
                yAxis: { domain: [-1, 5] },
                xAxis: { domain: [-1, 5] }
            },
            options: [
                { text: "$]1 ; 3[$", correct: true },
                { text: "$[1 ; 3]$", correct: false },
                { text: "$]-\\infty ; 1[ \\cup ]3 ; +\\infty[$", correct: false },
                { text: "$]3 ; 4]$", correct: false }
            ],
            hint: "üí° Cherche pour quels $x$ la courbe est strictement au-dessus de la ligne $y=3$.",
            explanation: "La bosse de la courbe d√©passe la hauteur 3 pour les $x$ compris strictement entre 1 et 3."
        },

        // Q7 : Un ant√©c√©dent sur Courbe "Main Lev√©e"
        {
            question: "Donner un ant√©c√©dent de $2$ par la fonction repr√©sent√©e ci-dessous :",
            plotConfig: {
                data: [
                    { points: q7Curve, fnType: 'points', graphType: 'polyline', color: '#5b21b6', attr: { "stroke-width": 3 } },
                    { points: q7Points, fnType: 'points', graphType: 'scatter', color: 'black', attr: {r: 4} },
                    { fn: '2', color: '#9ca3af', attr: {'stroke-dasharray': '5,5'}, isHint: true },
                    { points: [[3, 2]], fnType: 'points', graphType: 'scatter', color: '#db2777', attr: {r: 5}, isHint: true }
                ],
                yAxis: { domain: [-3, 5] },
                xAxis: { domain: [-4, 6] }
            },
            options: [
                { text: "$3$", correct: true },
                { text: "$2$", correct: false },
                { text: "$4$", correct: false },
                { text: "$0$", correct: false } // MODIFICATION : Ajout de 0 comme pi√®ge
            ],
            hint: "üí° Trace une ligne horizontale √† la hauteur $y=2$. Trouve le point de la courbe qui est sur cette ligne et lis son abscisse ($x$).",
            explanation: "En tra√ßant la droite $y=2$, on voit qu'elle coupe la courbe au point de coordonn√©es $(3 ; 2)$. L'ant√©c√©dent est donc $3$."
        },

        // Q8 : Nombre de solutions
        {
            question: "Combien l'√©quation $f(x) = 1$ admet-elle de solutions ?",
            plotConfig: {
                data: [
                    { fn: '0.1*x^3 - x + 0.5', color: '#5b21b6', attr: { "stroke-width": 3 } },
                    { fn: '1', color: '#9ca3af', attr: {'stroke-dasharray': '5,5'}, isHint: true }
                ],
                yAxis: { domain: [-3, 3] },
                xAxis: { domain: [-4, 4] }
            },
            options: [
                { text: "1 solution", correct: false },
                { text: "2 solutions", correct: false },
                { text: "3 solutions", correct: true },
                { text: "0 solution", correct: false }
            ],
            hint: "üí° Regarde combien de fois la courbe coupe la ligne horizontale $y=1$.",
            explanation: "La ligne $y=1$ traverse la courbe √† trois reprises."
        },

        // Q9 : Equation impossible
        {
            question: "R√©soudre graphiquement l'√©quation $f(x) = -5$.",
            plotConfig: {
                data: [
                    { fn: 'x^2', color: '#5b21b6', attr: { "stroke-width": 3 } },
                    { fn: '-5', color: '#9ca3af', attr: {'stroke-dasharray': '5,5'}, isHint: true }
                ],
                yAxis: { domain: [-6, 5] },
                xAxis: { domain: [-4, 4] }
            },
            options: [
                { text: "$S = \\emptyset$", correct: true },
                { text: "$S = \\{-5\\}$", correct: false },
                { text: "$S = \\{0\\}$", correct: false },
                { text: "$S = \\{ -2,2 ; 2,2 \\}$", correct: false }
            ],
            hint: "üí° La courbe descend-elle jusqu'√† la hauteur -5 ?",
            explanation: "La courbe est enti√®rement situ√©e au-dessus de l'axe des abscisses ($y \\ge 0$). Elle ne croise jamais la ligne $y=-5$."
        },

        // Q10 : La courbe en W (Nombre de solutions)
        {
            question: "Combien l'√©quation $f(x) = 1$ admet-elle de solutions ?",
            plotConfig: {
                data: [
                    { fn: '0.2*(x+2)*(x-1)*(x-3)*(x+1) + 1.5', color: '#5b21b6', attr: { "stroke-width": 3 } },
                    { fn: '1', color: '#9ca3af', attr: {'stroke-dasharray': '5,5'}, isHint: true }
                ],
                yAxis: { domain: [-2, 5] },
                xAxis: { domain: [-4, 4] }
            },
            options: [
                { text: "2", correct: false },
                { text: "3", correct: false },
                { text: "4", correct: true },
                { text: "0", correct: false }
            ],
            hint: "üí° Imagine une droite horizontale √† la hauteur 1. Combien de fois coupe-t-elle la courbe violette ?",
            explanation: "La droite $y=1$ coupe la courbe en 4 points distincts."
        }
    ];

    let currentQIndex = 0;
    let score = 0;
    let hasFailedCurrent = false;
    let answersState = new Array(quizData.length).fill(null); 

    document.getElementById('total-q').innerText = quizData.length;

    function typesetMath() {
        if (window.MathJax) MathJax.typesetPromise().catch(err => console.log(err));
    }

    function loadQuestion() {
        const qData = quizData[currentQIndex];
        hasFailedCurrent = false; 

        document.getElementById('question-text').innerHTML = qData.question;
        document.getElementById('current-q').innerText = currentQIndex + 1;
        document.getElementById('progress-bar').style.width = ((currentQIndex) / quizData.length * 100) + "%";

        const hintArea = document.getElementById('hint-area');
        const successArea = document.getElementById('success-area');
        hintArea.style.display = 'none';
        successArea.style.display = 'none';

        const nextBtn = document.getElementById('btn-next');
        const prevBtn = document.getElementById('btn-prev');
        
        nextBtn.style.display = 'flex';
        nextBtn.innerText = (currentQIndex === quizData.length - 1) ? "Voir R√©sultats üèÜ" : "Suivant ‚Üí";
        nextBtn.disabled = false; 

        prevBtn.style.display = (currentQIndex > 0) ? 'flex' : 'none';

        const optsDiv = document.getElementById('options-container');
        optsDiv.innerHTML = "";
        
        qData.options.forEach((opt, idx) => {
            const btn = document.createElement('button');
            btn.className = 'btn-option';
            btn.innerHTML = `<strong>${String.fromCharCode(65+idx)})</strong>&nbsp; ${opt.text}`;
            btn.onclick = () => checkAnswer(opt, btn);
            optsDiv.appendChild(btn);
        });

        const visualArea = document.getElementById('visual-area');
        visualArea.innerHTML = ''; 
        
        const alreadyAnswered = answersState[currentQIndex] !== null;
        setTimeout(() => renderFunctionPlot(qData.plotConfig, alreadyAnswered), 50);

        typesetMath();
    }

    function renderFunctionPlot(config, showHints) {
        let dataToUse = config.data;
        const filteredData = dataToUse.filter(item => showHints ? true : !item.isHint);
        
        const width = document.getElementById('visual-area').clientWidth;
        const height = document.getElementById('visual-area').clientHeight;

        functionPlot(Object.assign({}, config, {
            target: '#visual-area',
            width: width,
            height: height,
            grid: true,
            disableZoom: true,
            data: filteredData,
            tip: {
                xLine: true,
                yLine: true,
                renderer: function (x, y, index) { return `x: ${x.toFixed(2)}, y: ${y.toFixed(2)}`; }
            }
        }));
    }

    function checkAnswer(optionData, btnElement) {
        const hintArea = document.getElementById('hint-area');
        const successArea = document.getElementById('success-area');
        const qData = quizData[currentQIndex];

        answersState[currentQIndex] = optionData.correct;

        if (optionData.correct) {
            btnElement.classList.add('correct');
            document.querySelectorAll('.btn-option').forEach(b => b.disabled = true);
            
            hintArea.style.display = 'none';
            successArea.innerHTML = `<strong>‚úÖ Exact !</strong><br>${qData.explanation}`;
            successArea.style.display = 'block';
            typesetMath();

            if (!hasFailedCurrent) {
                score++;
                document.getElementById('current-score-display').innerText = score;
            }
            renderFunctionPlot(qData.plotConfig, true);

        } else {
            hasFailedCurrent = true;
            btnElement.classList.add('wrong');
            btnElement.disabled = true;
            hintArea.innerHTML = qData.hint;
            hintArea.style.display = 'block';
            renderFunctionPlot(qData.plotConfig, true);
            typesetMath();
        }
    }

    function nextQuestion() {
        if (currentQIndex < quizData.length - 1) {
            currentQIndex++;
            loadQuestion();
        } else {
            showResults();
        }
    }

    function prevQuestion() {
        if (currentQIndex > 0) {
            currentQIndex--;
            loadQuestion();
        }
    }

    function showResults() {
        document.getElementById('quiz-area').style.display = 'none';
        document.getElementById('result-area').style.display = 'block';
        document.getElementById('final-score').innerText = `${score}`;
        document.getElementById('progress-bar').style.width = "100%";
        
        const percentage = (score / quizData.length) * 100;
        document.getElementById('score-circle').style.background = 
            `conic-gradient(var(--primary) ${percentage}%, #e5e7eb ${percentage}%)`;

        let comment = "";
        if(score === quizData.length) comment = "ü•á Excellent travail !";
        else if(score >= 8) comment = "ü•à Tr√®s bon niveau !";
        else if(score >= 5) comment = "ü•â Bien jou√© !";
        else comment = "üí™ Courage, continue !";
        
        document.getElementById('comment-score').innerText = comment;
    }

    window.addEventListener('resize', () => {
        const qData = quizData[currentQIndex];
        const isAnswered = document.querySelector('.btn-option.correct') || document.querySelector('.btn-option.wrong');
        renderFunctionPlot(qData.plotConfig, !!isAnswered);
    });
    
    window.onload = loadQuestion;
</script>

</body>
</html>
